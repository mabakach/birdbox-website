<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="de">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Birdbox Live Stream</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
.stream-container {
	max-width: 100%;
	margin: 20px auto;
}

.stream-container img {
	max-width: 100%;
	height: auto;
}

.footer {
	position: static;
	width: 100%;
	padding: 1rem;
	background-color: #f8f9fa;
	margin-top: 40px;
}
#sensorDataTable td:first-child {
    text-align: left;
}
#sensorDataTable td:last-child {
    text-align: right;
}
</style>
</head>
<body>
	<!-- Header -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container">
			<a class="navbar-brand" href="#">Birdbox</a>
		</div>
	</nav>

	<!-- Main Content -->
	<div class="container">
		<div class="row mt-4">
			<div class="col-12 text-center">
				
				<div class="d-flex flex-column justify-content-center align-items-center">
					<div class="stream-container">
						<h1>Livestream aus dem Vogelhaus</h1>
						<img th:src="${streamUrl}" alt="Bird Box Live Stream">
					</div>
					<div id="current-temperature-container" class="align-self-center mt-4">
						<table id="sensorDataTable" class="table table-borderless" style="margin-bottom: 0;">
							<tr>
								<td><strong>Aktuelle Temperatur</strong></td>
								<td><span id="tempValue" th:text="${currentTemperature}">${currentTemperature}</span> </td>
							</tr>
							<tr>
								<td><strong>Aktuelle Luftfeuchtigkeit</strong></td>
								<td><span id="humidityValue" th:text="${currentHumidity}">${currentHumidity}</span> %</td>
							</tr>
							<tr>
							    <td><strong>Letztes Update</strong></td>
							    <td><span id="lastUpdateValue" th:text="${lastUpdateTime}">${lastUpdateTime}</span></td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- Footer -->
	<footer class="footer text-center">
		<div class="container">
			<span class="text-muted">&copy; 2025 Marc Baumgartner. Alle Rechte vorbehalten. | 
				<a href="https://github.com/mabakach/birdbox-website" target="_blank" rel="noopener noreferrer">Projekt auf GitHub</a>
			</span>
			<span id="appVersion" th:text="${appVersion}"> | Version: ${appVersion}</span>
		</div>
	</footer>

	<script
		src="/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sockjs.min.js"></script>
	<script src="/js/stomp.min.js"></script>
	<script>
		function connectSensorWebSocket() {
			var socket = new SockJS('/ws');
			var stompClient = Stomp.over(socket);
			stompClient.connect({}, function (frame) {
				stompClient.subscribe('/topic/SensorResponse', function (message) {
					var data = JSON.parse(message.body);
					var temperature = data.temperature_celsius !== undefined ? data.temperature : '-';
					var humidity = data.humidity !== undefined ? data.humidity : '-';
					var timestamp = data.readTimestamp ? new Date(data.readTimestamp).toLocaleString() : '-';
					document.getElementById('tempValue').textContent = temperature;
					document.getElementById('humidityValue').textContent = humidity;
					document.getElementById('lastUpdateValue').textContent = timestamp;
				});
			});
		}
		document.addEventListener('DOMContentLoaded', connectSensorWebSocket);
	</script>
</body>
</html>