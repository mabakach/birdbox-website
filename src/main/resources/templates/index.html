<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="de">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Birdbox Live Stream</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
.stream-container {
	max-width: 100%;
	margin: 20px auto;
}

.stream-container img {
	max-width: 100%;
	height: auto;
}

.footer {
	position: fixed;
	bottom: 0;
	width: 100%;
	padding: 1rem;
	background-color: #f8f9fa;
}
</style>
</head>
<body>
	<!-- Header -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container">
			<a class="navbar-brand" href="#">Birdbox</a>
		</div>
	</nav>

	<!-- Main Content -->
	<div class="container">
		<div class="row mt-4">
			<div class="col-12 text-center">
				<h1>Livestream aus dem Vogelhaus</h1>
				<div class="stream-container">
					<img th:src="${streamUrl}" alt="Bird Box Live Stream">
				</div>
				<div id="current-temperature-container">
				
				</div>
			</div>
		</div>
	</div>


	<!-- Footer -->
	<footer class="footer text-center">
		<div class="container">
			<span class="text-muted">&copy; 2025 Marc Baumgartner. Alle
				Rechte vorbehalten.</span>
		</div>
	</footer>

	<script
		src="/js/bootstrap.bundle.min.js"></script>
	<script src="/js/sockjs.min.js"></script>
	<script src="/js/stomp.min.js"></script>
	<script>
		function connectSensorWebSocket() {
			var socket = new SockJS('/ws');
			var stompClient = Stomp.over(socket);
			stompClient.connect({}, function (frame) {
				stompClient.subscribe('/topic/SensorResponse', function (message) {
					var data = JSON.parse(message.body);
					var temperature = data.temperature_celsius !== undefined ? data.temperature_celsius : '-';
					var humidity = data.humidity !== undefined ? data.humidity : '-';
					var timestamp = data.readTimestamp ? new Date(data.readTimestamp).toLocaleString() : '-';
					var html = '<div class="alert alert-info">'
						+ '<strong>Aktuelle Temperatur:</strong> ' + temperature + ' Â°C<br>'
						+ '<strong>Aktuelle Luftfeuchtigkeit:</strong> ' + humidity + ' %<br>'
						+ '<strong>Letztes Update:</strong> ' + timestamp
						+ '</div>';
					document.querySelector('#current-temperature-container').innerHTML = html;
				});
			});
		}
		document.addEventListener('DOMContentLoaded', connectSensorWebSocket);
	</script>
</body>
</html>